<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blockchain Block Visualizer</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: Arial; background: #1a1a2e; color: #eee; padding: 30px; }
    h1 { text-align: center; color: #00d4ff; margin-bottom: 10px; font-size: 28px; }
    p.subtitle { text-align: center; color: #888; margin-bottom: 30px; }
    #status { text-align: center; color: #f39c12; margin-bottom: 20px; font-size: 14px; }
    
    .controls { display: flex; justify-content: center; gap: 10px; margin-bottom: 30px; }
    button { padding: 10px 25px; background: #00d4ff; color: #1a1a2e; border: none; 
             cursor: pointer; border-radius: 5px; font-size: 14px; font-weight: bold; }
    button:hover { background: #00b8d9; }
    
    .chain { display: flex; flex-wrap: wrap; align-items: center; gap: 0; justify-content: center; }
    
    .block-card {
      background: #16213e;
      border: 2px solid #00d4ff;
      border-radius: 10px;
      padding: 15px;
      width: 220px;
      position: relative;
      transition: transform 0.2s;
    }
    .block-card:hover { transform: translateY(-5px); border-color: #f39c12; }
    
    .block-number {
      background: #00d4ff;
      color: #1a1a2e;
      font-weight: bold;
      font-size: 16px;
      padding: 5px 10px;
      border-radius: 5px;
      margin-bottom: 12px;
      text-align: center;
    }
    .genesis .block-number { background: #2ecc71; }
    
    .block-field { margin-bottom: 8px; }
    .block-field .label { font-size: 10px; color: #888; text-transform: uppercase; margin-bottom: 2px; }
    .block-field .value { font-size: 12px; color: #eee; word-break: break-all; }
    .block-field .value.hash { color: #00d4ff; font-family: monospace; }
    .block-field .value.prev-hash { color: #f39c12; font-family: monospace; }
    .block-field .value.tx { color: #2ecc71; font-weight: bold; }

    .arrow {
      font-size: 30px;
      color: #00d4ff;
      padding: 0 5px;
      flex-shrink: 0;
    }

    .stats {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    .stat-card {
      background: #16213e;
      border: 1px solid #00d4ff;
      border-radius: 8px;
      padding: 15px 25px;
      text-align: center;
    }
    .stat-card .stat-number { font-size: 28px; color: #00d4ff; font-weight: bold; }
    .stat-card .stat-label { font-size: 12px; color: #888; margin-top: 4px; }

    .no-blocks { text-align: center; color: #888; margin-top: 50px; font-size: 16px; }
  </style>
</head>
<body>

  <h1>‚õìÔ∏è Blockchain Block Visualizer</h1>
  <p class="subtitle">Connected to Ganache Local Blockchain</p>
  <p id="status">Connecting to Ganache...</p>

  <div class="stats">
    <div class="stat-card">
      <div class="stat-number" id="totalBlocks">0</div>
      <div class="stat-label">Total Blocks</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="totalTx">0</div>
      <div class="stat-label">Total Transactions</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="latestBlock">0</div>
      <div class="stat-label">Latest Block</div>
    </div>
  </div>

  <div class="controls">
    <button onclick="loadBlocks()">üîÑ Refresh Blocks</button>
    <button onclick="toggleOrder()">üîÉ Toggle Order</button>
  </div>

  <div class="chain" id="chain">
    <p class="no-blocks">Loading blocks...</p>
  </div>

  <script>
    let web3;
    let reverseOrder = false;

    async function init() {
      try {
        web3 = new Web3('http://127.0.0.1:7545');
        const blockNumber = await web3.eth.getBlockNumber();
        document.getElementById('status').innerText = '‚úÖ Connected to Ganache! Latest block: #' + blockNumber;
        document.getElementById('status').style.color = '#2ecc71';
        loadBlocks();
      } catch (err) {
        document.getElementById('status').innerText = '‚ùå Cannot connect to Ganache! Make sure Ganache is running on port 7545';
        document.getElementById('status').style.color = '#e74c3c';
      }
    }

    async function loadBlocks() {
      const chain = document.getElementById('chain');
      chain.innerHTML = '<p class="no-blocks">Loading blocks...</p>';

      try {
        const latestBlockNumber = await web3.eth.getBlockNumber();
        let blocks = [];

        for (let i = 0; i <= latestBlockNumber; i++) {
          const block = await web3.eth.getBlock(i);
          blocks.push(block);
        }

        // Update stats
        document.getElementById('totalBlocks').innerText = blocks.length;
        document.getElementById('latestBlock').innerText = latestBlockNumber;
        let totalTx = 0;
        blocks.forEach(b => totalTx += b.transactions.length);
        document.getElementById('totalTx').innerText = totalTx;

        // Sort order
        if (reverseOrder) blocks = blocks.reverse();

        // Render blocks
        chain.innerHTML = '';
        blocks.forEach((block, index) => {
          const isGenesis = block.number === 0;
          const date = new Date(block.timestamp * 1000).toLocaleString();
          const prevHash = block.parentHash.substring(0, 20) + '...';
          const currHash = block.hash.substring(0, 20) + '...';

          const card = document.createElement('div');
          card.className = 'block-card' + (isGenesis ? ' genesis' : '');
          card.innerHTML = `
            <div class="block-number">${isGenesis ? 'üå± GENESIS BLOCK' : 'üì¶ BLOCK #' + block.number}</div>
            <div class="block-field">
              <div class="label">Hash</div>
              <div class="value hash">${currHash}</div>
            </div>
            <div class="block-field">
              <div class="label">Previous Hash</div>
              <div class="value prev-hash">${prevHash}</div>
            </div>
            <div class="block-field">
              <div class="label">Mined On</div>
              <div class="value">${date}</div>
            </div>
            <div class="block-field">
              <div class="label">Transactions</div>
              <div class="value tx">${block.transactions.length} transaction(s)</div>
            </div>
            <div class="block-field">
              <div class="label">Gas Used</div>
              <div class="value">${block.gasUsed}</div>
            </div>
          `;
          chain.appendChild(card);

          // Add arrow between blocks
          if (index < blocks.length - 1) {
            const arrow = document.createElement('div');
            arrow.className = 'arrow';
            arrow.innerText = '‚Üí';
            chain.appendChild(arrow);
          }
        });

      } catch (err) {
        chain.innerHTML = '<p class="no-blocks">‚ùå Error loading blocks. Is Ganache running?</p>';
      }
    }

    function toggleOrder() {
      reverseOrder = !reverseOrder;
      loadBlocks();
    }

    window.addEventListener('load', init);
  </script>

</body>
</html>